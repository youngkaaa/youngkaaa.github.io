<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="Ijkplayer-video_display2"/>




  <meta name="keywords" content="ijkplayer," />





  <link rel="alternate" href="/default" title="å’”å’”å’”" >




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="https://youngkaaa.github.io/205c40e1.html"/>


<meta name="description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»ä½äºff_ffplay.cæ–‡ä»¶ä¸­çš„video_display2()æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥åˆ·æ–°å±•ç¤ºè§†é¢‘å¸§çš„ï¼Œå…·ä½“è°ƒç”¨è·¯å¾„åˆ†æè¯¦è§video_refresh_threadã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Ijkplayer-video_display2">
<meta property="og:url" content="https://youngkaaa.github.io/205c40e1.html">
<meta property="og:site_name" content="å’”å’”å’”">
<meta property="og:description" content="æœ¬æ–‡ä¸»è¦ä»‹ç»ä½äºff_ffplay.cæ–‡ä»¶ä¸­çš„video_display2()æ–¹æ³•ã€‚ è¯¥æ–¹æ³•ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥åˆ·æ–°å±•ç¤ºè§†é¢‘å¸§çš„ï¼Œå…·ä½“è°ƒç”¨è·¯å¾„åˆ†æè¯¦è§video_refresh_threadã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-03-22T09:51:08.000Z">
<meta property="article:modified_time" content="2022-07-29T15:03:31.424Z">
<meta property="article:author" content="å’”å’”å’”">
<meta property="article:tag" content="ijkplayer">
<meta name="twitter:card" content="summary">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> Ijkplayer-video_display2 - å’”å’”å’” </title>
  <meta name="generator" content="Hexo 6.2.0"></head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">å’”å’”å’”</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Ijkplayer-video_display2
        
      </h1>

      <time class="post-time">
          3æœˆ 22 2020
      </time>
    </header>



    
            <div class="post-content">
            <p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä½äºff_ffplay.cæ–‡ä»¶ä¸­çš„video_display2()æ–¹æ³•ã€‚</p>
<p>è¯¥æ–¹æ³•ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥åˆ·æ–°å±•ç¤ºè§†é¢‘å¸§çš„ï¼Œå…·ä½“è°ƒç”¨è·¯å¾„åˆ†æè¯¦è§<a href="e1139ab6.html">video_refresh_thread</a>ã€‚</p>
<span id="more"></span>

<blockquote>
<p>ff_ffplay.c#video_display2()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">video_display2</span><span class="params">(FFPlayer *ffp)</span> &#123;</span><br><span class="line">    VideoState *is = ffp-&gt;is;</span><br><span class="line">    <span class="keyword">if</span> (is-&gt;video_st)</span><br><span class="line">        video_image_display2(ffp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œæœ¬æ–¹æ³•çš„ä¸»è¦é€»è¾‘æ˜¯åœ¨video_image_display2()ä¸­çš„ï¼Œæ‰€ä»¥ä¸‹é¢ç€é‡åˆ†æè¿™ä¸ªæ–¹æ³•:</p>
<blockquote>
<p>ff_ffplay.c#video_image_display2()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">video_image_display2</span><span class="params">(FFPlayer *ffp)</span> &#123;</span><br><span class="line">    VideoState *is = ffp-&gt;is;</span><br><span class="line">    Frame *vp;</span><br><span class="line">    Frame *sp = <span class="literal">NULL</span>;</span><br><span class="line">  	<span class="comment">// ç¬¬1æ­¥</span></span><br><span class="line">    vp = frame_queue_peek_last(&amp;is-&gt;pictq);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vp-&gt;bmp) &#123;</span><br><span class="line">      	<span class="comment">// ç¬¬2æ­¥</span></span><br><span class="line">        <span class="keyword">if</span> (is-&gt;subtitle_st) &#123;</span><br><span class="line">            <span class="keyword">if</span> (frame_queue_nb_remaining(&amp;is-&gt;subpq) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                sp = frame_queue_peek(&amp;is-&gt;subpq);</span><br><span class="line">                <span class="keyword">if</span> (vp-&gt;pts &gt;= sp-&gt;pts + ((<span class="type">float</span>) sp-&gt;sub.start_display_time / <span class="number">1000</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!sp-&gt;uploaded) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (sp-&gt;sub.num_rects &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="type">char</span> buffered_text[<span class="number">4096</span>];</span><br><span class="line">                            <span class="keyword">if</span> (sp-&gt;sub.rects[<span class="number">0</span>]-&gt;text) &#123;</span><br><span class="line">                                <span class="built_in">strncpy</span>(buffered_text, sp-&gt;sub.rects[<span class="number">0</span>]-&gt;text, <span class="number">4096</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sp-&gt;sub.rects[<span class="number">0</span>]-&gt;ass) &#123;</span><br><span class="line">                                parse_ass_subtitle(sp-&gt;sub.rects[<span class="number">0</span>]-&gt;ass, buffered_text);</span><br><span class="line">                            &#125;</span><br><span class="line">                            ffp_notify_msg4(ffp, FFP_MSG_TIMED_TEXT, <span class="number">0</span>, <span class="number">0</span>, buffered_text, <span class="keyword">sizeof</span>(buffered_text));</span><br><span class="line">                        &#125;</span><br><span class="line">                        sp-&gt;uploaded = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      	<span class="comment">// ç¬¬3æ­¥</span></span><br><span class="line">        <span class="keyword">if</span> (ffp-&gt;render_wait_start &amp;&amp; !ffp-&gt;start_on_prepared &amp;&amp; is-&gt;pause_req) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!ffp-&gt;first_video_frame_rendered) &#123;</span><br><span class="line">                ffp-&gt;first_video_frame_rendered = <span class="number">1</span>;</span><br><span class="line">                ffp_notify_msg1(ffp, FFP_MSG_VIDEO_RENDERING_START);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (is-&gt;pause_req &amp;&amp; !is-&gt;abort_request) &#123;</span><br><span class="line">                SDL_Delay(<span class="number">20</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      	<span class="comment">// ç¬¬4æ­¥</span></span><br><span class="line">        SDL_VoutDisplayYUVOverlay(ffp-&gt;vout, vp-&gt;bmp);</span><br><span class="line">        ffp-&gt;stat.vfps = SDL_SpeedSamplerAdd(&amp;ffp-&gt;vfps_sampler, FFP_SHOW_VFPS_FFPLAY, <span class="string">&quot;vfps[ffplay]&quot;</span>);</span><br><span class="line">      	<span class="comment">// ç¬¬5æ­¥</span></span><br><span class="line">        <span class="keyword">if</span> (!ffp-&gt;first_video_frame_rendered) &#123;</span><br><span class="line">            ffp-&gt;first_video_frame_rendered = <span class="number">1</span>;</span><br><span class="line">            ffp_notify_msg1(ffp, FFP_MSG_VIDEO_RENDERING_START);</span><br><span class="line">        &#125;</span><br><span class="line">      	<span class="comment">// ç¬¬6æ­¥</span></span><br><span class="line">        <span class="keyword">if</span> (is-&gt;latest_video_seek_load_serial == vp-&gt;serial) &#123;</span><br><span class="line">            <span class="type">int</span> latest_video_seek_load_serial = __atomic_exchange_n(&amp;(is-&gt;latest_video_seek_load_serial), <span class="number">-1</span>,memory_order_seq_cst);</span><br><span class="line">            <span class="keyword">if</span> (latest_video_seek_load_serial == vp-&gt;serial) &#123;</span><br><span class="line">                ffp-&gt;stat.latest_seek_load_duration = (av_gettime() - is-&gt;latest_seek_load_start_at) / <span class="number">1000</span>;</span><br><span class="line">                <span class="keyword">if</span> (ffp-&gt;av_sync_type == AV_SYNC_VIDEO_MASTER) &#123;</span><br><span class="line">                    ffp_notify_msg2(ffp, FFP_MSG_VIDEO_SEEK_RENDERING_START, <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ffp_notify_msg2(ffp, FFP_MSG_VIDEO_SEEK_RENDERING_START, <span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</blockquote>
<p>ç²¾ç®€ä¸‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">video_image_display2</span><span class="params">(FFPlayer *ffp)</span> &#123;</span><br><span class="line">	<span class="comment">// ç¬¬1æ­¥</span></span><br><span class="line"> <span class="keyword">if</span> (vp-&gt;bmp) &#123;</span><br><span class="line">   	<span class="comment">// ç¬¬2æ­¥</span></span><br><span class="line">   	<span class="comment">// ç¬¬3æ­¥</span></span><br><span class="line">   	<span class="comment">// ç¬¬4æ­¥</span></span><br><span class="line">   	<span class="comment">// ç¬¬5æ­¥</span></span><br><span class="line">   	<span class="comment">// ç¬¬6æ­¥</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¯´ï¼Œåé¢çš„2-6æ­¥çš„æ‰§è¡Œå‰ææ˜¯bmpä¸ä¸ºç©ºï¼Œå…³äºbmpçš„åˆ›å»ºåœ¨<a href="fe1f1f62.html">queue_picture</a>ä¸­çš„ç¬¬3æ­¥å†…æœ‰ä»‹ç»è¿‡ã€‚</p>
<h5 id="ç¬¬1æ­¥ï¼š"><a href="#ç¬¬1æ­¥ï¼š" class="headerlink" title="ç¬¬1æ­¥ï¼š"></a>ç¬¬1æ­¥ï¼š</h5><p>éœ€æ³¨æ„ï¼Œåœ¨<a href="e1139ab6.html">video_refresh_thread</a>ä¸­æœ€ç»ˆè°ƒç”¨æœ¬æ–¹æ³•å‰ï¼Œå·²ç»è°ƒç”¨äº†<a href="866c32fa.html">frame_queue_next</a>æ–¹æ³•æ¥å°†lastvpä¸¢æ‰äº†ï¼Œæ‰€ä»¥æ­¤æ—¶è°ƒç”¨<a href="866c32fa.html">frame_queue_peek_last</a>æ–¹æ³•è·å–çš„å°±æ˜¯<a href="e1139ab6.html">video_refresh_thread</a>ä¸­çš„vpï¼Œä¹Ÿå°±æ˜¯åˆæ³•çš„å½“å‰è¯¥å±•ç¤ºçš„å¸§äº†ã€‚</p>
<h5 id="ç¬¬2æ­¥ï¼š"><a href="#ç¬¬2æ­¥ï¼š" class="headerlink" title="ç¬¬2æ­¥ï¼š"></a>ç¬¬2æ­¥ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is-&gt;subtitle_st) &#123;</span><br><span class="line">    <span class="keyword">if</span> (frame_queue_nb_remaining(&amp;is-&gt;subpq) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sp = frame_queue_peek(&amp;is-&gt;subpq);</span><br><span class="line">        <span class="keyword">if</span> (vp-&gt;pts &gt;= sp-&gt;pts + ((<span class="type">float</span>) sp-&gt;sub.start_display_time / <span class="number">1000</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!sp-&gt;uploaded) &#123;</span><br><span class="line">                <span class="keyword">if</span> (sp-&gt;sub.num_rects &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">char</span> buffered_text[<span class="number">4096</span>];</span><br><span class="line">                    <span class="keyword">if</span> (sp-&gt;sub.rects[<span class="number">0</span>]-&gt;text) &#123;</span><br><span class="line">                        <span class="built_in">strncpy</span>(buffered_text, sp-&gt;sub.rects[<span class="number">0</span>]-&gt;text, <span class="number">4096</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sp-&gt;sub.rects[<span class="number">0</span>]-&gt;ass) &#123;</span><br><span class="line">                        parse_ass_subtitle(sp-&gt;sub.rects[<span class="number">0</span>]-&gt;ass, buffered_text);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ffp_notify_msg4(ffp, FFP_MSG_TIMED_TEXT, <span class="number">0</span>, <span class="number">0</span>, buffered_text, <span class="keyword">sizeof</span>(buffered_text));</span><br><span class="line">                &#125;</span><br><span class="line">                sp-&gt;uploaded = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†å­—å¹•ç›¸å…³çš„ï¼Œä¸»è¦æ˜¯å­—å¹•å†…å®¹å›è°ƒã€‚</p>
<h5 id="ç¬¬3æ­¥ï¼š"><a href="#ç¬¬3æ­¥ï¼š" class="headerlink" title="ç¬¬3æ­¥ï¼š"></a>ç¬¬3æ­¥ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ffp-&gt;render_wait_start &amp;&amp; !ffp-&gt;start_on_prepared &amp;&amp; is-&gt;pause_req) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!ffp-&gt;first_video_frame_rendered) &#123;</span><br><span class="line">        ffp-&gt;first_video_frame_rendered = <span class="number">1</span>;</span><br><span class="line">        ffp_notify_msg1(ffp, FFP_MSG_VIDEO_RENDERING_START);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (is-&gt;pause_req &amp;&amp; !is-&gt;abort_request) &#123;</span><br><span class="line">        SDL_Delay(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ffp-&gt;render_wait_start</p>
<p>å®˜æ–¹æ³¨é‡Šä¸º:render wait startğŸ˜‚ï¼Œç­‰å¼€å§‹æ’­æ”¾æ—¶å†ç»˜åˆ¶æ¸²æŸ“ã€‚ç”±ç”¨æˆ·æŒ‡å®šï¼Œé»˜è®¤ä¸º0ã€‚åœ¨éŸ³é¢‘å’Œè§†é¢‘è¾“å‡ºçš„æ–¹æ³•ä¸­éƒ½æœ‰å¦‚ä¸Šåˆ¤æ–­ï¼Œæˆ‘çš„ç†è§£æ˜¯:å½“å…¶å¼€å¯æ—¶ï¼Œåªè¦æ²¡å¼€å§‹æ’­æ”¾ï¼Œé‚£ä¹ˆå°±ä¸æ¸²æŸ“(éŸ³é¢‘è¾“å‡ºå’Œè§†é¢‘å±•ç¤º)ï¼Œå°½ç®¡æœ‰æ•°æ®å¯æ¸²æŸ“ä¹Ÿä¸ä¼šæ¸²æŸ“è€Œæ˜¯ä¸€ç›´ç­‰å¾…ï¼Œç­‰å¼€å§‹æ’­æ”¾æ—¶æ‰æ¸²æŸ“ã€‚</p>
</blockquote>
<blockquote>
<p>ffp-&gt;start_on_prepared</p>
<p>æ˜¯å¦åœ¨å‡†å¤‡å¥½ä¹‹åè‡ªåŠ¨å¼€å§‹æ’­æ”¾ã€‚ç”±ç”¨æˆ·æŒ‡å®šï¼Œé»˜è®¤ä¸º0ã€‚å¦‚æœå¼€å…³æ‰“å¼€ï¼Œé‚£ä¹ˆå½“prepareæˆåŠŸæ—¶ï¼Œä¼šåœ¨æ¶ˆæ¯å¤„ç†ä½“ä¸­è‡ªåŠ¨å¼€å§‹æ’­æ”¾ï¼Œè¯¦è§ijkplayer.c#ijkmp_get_msg()æ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>is-&gt;pause_req</p>
<p>å½“å‰æ˜¯å¦æ˜¯æš‚åœã€‚æš‚åœæ˜¯ä¼šå°†å…¶ç½®ä¸º1ï¼Œå¦åˆ™ç½®ä¸º0ã€‚</p>
</blockquote>
<p>æ‰€ä»¥è¿™é‡Œå°±æ˜¯å¦‚æœæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°±ä¸€ç›´ç­‰å¾…ä¼‘çœ ç›´åˆ°å¼€å§‹æ’­æ”¾äº†ï¼Œä¹Ÿå°±æ˜¯is-&gt;pause_req&#x3D;0äº†ã€‚è¿™é‡Œè¿˜æœ‰ä¸ªfirst_video_frame_renderedçš„åˆ¤æ–­:</p>
<blockquote>
<p>ffp-&gt;first_video_frame_rendered</p>
<p>å½“å‰è§†é¢‘è½¨é“æ˜¯å¦å·²æ¸²æŸ“è¿‡ç¬¬ä¸€å¸§ã€‚ä¸»è¦èµ·æ ‡è¯†ä½œç”¨ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦å·²æ¸²æŸ“è¿‡ç¬¬ä¸€ä¸ªè§†é¢‘å¸§ï¼Œå¦‚æœæ²¡æœ‰çš„è¯é‚£ä¹ˆå½“å‰å‡†å¤‡æ¸²æŸ“çš„å°±æ˜¯ç¬¬ä¸€å¸§ï¼Œé‚£ä¹ˆå°†ä¼šå‘é€FFP_MSG_VIDEO_RENDERING_STARTæ¶ˆæ¯ã€‚</p>
</blockquote>
<p>æ‰€ä»¥æˆ‘è®¤ä¸ºè¿™é‡Œåˆ¤æ–­first_video_frame_renderedå¹¶è¿”å›FFP_MSG_VIDEO_RENDERING_STARTæ²¡æœ‰å¿…è¦ï¼Œå®Œå…¨å¯ä»¥æŒªåˆ°åé¢ç­‰æ­£å¼å±•ç¤ºç»˜åˆ¶äº†å†å±•ç¤ºï¼Œå› ä¸ºåœ¨ä¸‹é¢ç¬¬5æ­¥ä¸­è¿˜ä¼šæœ‰ä¸€ä¸ªåˆ¤æ–­ã€‚</p>
<h5 id="ç¬¬4æ­¥ï¼š"><a href="#ç¬¬4æ­¥ï¼š" class="headerlink" title="ç¬¬4æ­¥ï¼š"></a>ç¬¬4æ­¥ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SDL_VoutDisplayYUVOverlay(ffp-&gt;vout, vp-&gt;bmp);</span><br><span class="line">ffp-&gt;stat.vfps = SDL_SpeedSamplerAdd(&amp;ffp-&gt;vfps_sampler, FFP_SHOW_VFPS_FFPLAY, <span class="string">&quot;vfps[ffplay]&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ­¥ä¸­çš„SDL_VoutDisplayYUVOverlay()å°±æ˜¯æœ¬æ–¹æ³•çš„ä¸»è¦é€»è¾‘å®ç°ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä¸€äº›åˆæ³•æ€§ç­‰åˆ¤æ–­ã€‚SDL_VoutDisplayYUVOverlay()æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯å±•ç¤ºè¯¥å¸§æ•°æ®ã€‚ä¼ å…¥çš„æ˜¯ffp-&gt;voutå’Œvp-&gt;bmpï¼Œä¹Ÿå°±æ˜¯<a href="6c4c2c27.html">SDL_Vout</a>å’Œ<a href="e0c53a8e.html">SDL_VoutOverlay</a>ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯<a href="6c4c2c27.html">SDL_Vout</a>ä¸­çš„display_overlay()æ–¹æ³•æ¥å±•ç¤º<a href="e0c53a8e.html">SDL_VoutOverlay</a>ä¸­çš„æ•°æ®ã€‚è€Œå…³äºbmpçš„åˆ›å»ºåœ¨å‰é¢çš„<a href="fe1f1f62.html">queue_picture</a>ä¸­çš„ç¬¬3æ­¥å†…æœ‰ä»‹ç»è¿‡ã€‚</p>
<h5 id="ç¬¬5æ­¥ï¼š"><a href="#ç¬¬5æ­¥ï¼š" class="headerlink" title="ç¬¬5æ­¥ï¼š"></a>ç¬¬5æ­¥ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ffp-&gt;first_video_frame_rendered) &#123;</span><br><span class="line">    ffp-&gt;first_video_frame_rendered = <span class="number">1</span>;</span><br><span class="line">    ffp_notify_msg1(ffp, FFP_MSG_VIDEO_RENDERING_START);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€æ­¥åœ¨ä¸Šé¢ç¬¬3æ­¥ä¸­æåˆ°è¿‡äº†ã€‚è€Œåœ¨ç¬¬3æ­¥ä¸­ä¹Ÿè¯´è¿‡æ„Ÿè§‰ç¬¬3æ­¥ä¸­çš„first_video_frame_renderedåˆ¤æ–­å®Œå…¨å¯ä»¥æŒªåˆ°è¿™é‡Œæ¥ï¼Œç­‰çœŸæ­£çš„æ¸²æŸ“æ“ä½œæ‰§è¡Œäº†å†å‘é€FFP_MSG_VIDEO_RENDERING_STARTä¹Ÿè¡Œã€‚</p>
<h5 id="ç¬¬6æ­¥ï¼š"><a href="#ç¬¬6æ­¥ï¼š" class="headerlink" title="ç¬¬6æ­¥ï¼š"></a>ç¬¬6æ­¥ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (is-&gt;latest_video_seek_load_serial == vp-&gt;serial) &#123;</span><br><span class="line">        <span class="type">int</span> latest_video_seek_load_serial = __atomic_exchange_n(&amp;(is-&gt;latest_video_seek_load_serial), <span class="number">-1</span>,memory_order_seq_cst);</span><br><span class="line">        <span class="keyword">if</span> (latest_video_seek_load_serial == vp-&gt;serial) &#123;</span><br><span class="line">            ffp-&gt;stat.latest_seek_load_duration = (av_gettime() - is-&gt;latest_seek_load_start_at) / <span class="number">1000</span>;</span><br><span class="line">            <span class="keyword">if</span> (ffp-&gt;av_sync_type == AV_SYNC_VIDEO_MASTER) &#123;</span><br><span class="line">                ffp_notify_msg2(ffp, FFP_MSG_VIDEO_SEEK_RENDERING_START, <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ffp_notify_msg2(ffp, FFP_MSG_VIDEO_SEEK_RENDERING_START, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬6æ­¥ä¸»è¦å¤„ç†seekå®Œæ¯•çš„æ¶ˆæ¯é€šçŸ¥å·¥ä½œã€‚</p>
<blockquote>
<p>is-&gt;latest_video_seek_load_serial</p>
<p>è®°å½•å½“å‰seekå‘ç”Ÿæ—¶ï¼Œvideoqä¹Ÿå°±æ˜¯å­˜å‚¨è§†é¢‘å¾…è§£ç æ•°æ®çš„<a href="b5aae3f7.html">PacketQueue</a>é˜Ÿåˆ—ä¸­çš„serialã€‚åœ¨ff_ffplay.cä¸­çš„<a href="f13bb020.html">read_thread()</a>ä¸­ï¼Œå‘ç”Ÿäº†seekä¹‹åï¼Œä¼šå¾€è§†é¢‘ã€éŸ³é¢‘å’Œå­—å¹•çš„<a href="b5aae3f7.html">PacketQueue</a>é˜Ÿåˆ—åˆ†åˆ«æ”¾å…¥ä¸€ä¸ªflush_pktï¼Œç”¨äºè¡¨ç¤ºå½“å‰å‘ç”Ÿè¿‡seekï¼Œç„¶å<a href="b5aae3f7.html">PacketQueue</a>é˜Ÿåˆ—çš„serialä¼šè‡ªå¢(ä¹‹åæ”¾å…¥é˜Ÿåˆ—çš„AVPacketçš„serialéƒ½ä¼šæ˜¯è‡ªå¢ä¹‹åçš„serial)ï¼Œè‡ªå¢å®Œserialä¹‹åä¼šå°†å¯¹åº”<a href="b5aae3f7.html">PacketQueue</a>é˜Ÿåˆ—çš„serialä¿å­˜åˆ°å¯¹åº”çš„å€¼ä¸­ï¼Œæ¯”å¦‚è§†é¢‘çš„å°±æ˜¯ä¿å­˜åˆ°latest_video_seek_load_serialä¸­ï¼ŒéŸ³é¢‘çš„ä¿å­˜åˆ°latest_audio_seek_load_serialä¸­ï¼Œç”¨äºåç»­ä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰seekï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯-1ï¼Œå¦‚æœä¸æ˜¯-1ï¼Œé‚£ä¹ˆè¡¨ç¤ºå½“å‰æ˜¯seekçš„ã€‚</p>
</blockquote>
<p>æ‰€ä»¥è¿™é‡Œåˆ¤æ–­å¦‚æœlatest_video_seek_load_serialå’Œå½“å‰è¦å±•ç¤ºçš„vpçš„serialç›¸ç­‰ï¼Œè¡¨ç¤ºå½“å‰vpæ˜¯seekæˆåŠŸåè§†é¢‘å¸§ï¼Œé‚£ä¹ˆå†å‘é€FFP_MSG_VIDEO_SEEK_RENDERING_STARTæ¶ˆæ¯ã€‚æ³¨æ„è¿™é‡Œåˆ¤æ–­å®Œå°±ç«‹é©¬å°†å…¶é‡ç½®ä¸º-1äº†ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>æœ¬æ–¹æ³•ä¸»è¦ç”¨äºå±•ç¤ºframe_queue_peek_last(&amp;is-&gt;pictq)ä½ç½®çš„è§†é¢‘å¸§æ•°æ®ï¼Œä¸»è¦å±•ç¤ºé€»è¾‘æ˜¯SDL_VoutDisplayYUVOverlay()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨<a href="6c4c2c27.html">SDL_Vout</a>ä¸­çš„display_overlay()æ–¹æ³•æ¥å±•ç¤º<a href="e0c53a8e.html">SDL_VoutOverlay</a>ä¸­çš„æ•°æ®ã€‚</p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/ijkplayer/">ijkplayer</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/b5aae3f7.html">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Ijkplayer-PacketQueue</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/217ddfcf.html">
        <span class="next-text nav-default">Ijkplayer-Clock</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2020 -
    
    2023
    <span class="footer-author">å’”å’”å’”.</span>
    <span class="power-by">
        ç”± <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> and <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a> å¼ºåŠ›é©±åŠ¨
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
